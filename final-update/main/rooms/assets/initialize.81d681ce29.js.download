__d((function(g,r,i,a,m,e,d){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.hasPermission=p,e.requestPermission=async function(){if(!(0,o.supportsPushNotifications)())return!1;if('denied'===Notification.permission)return!1;if('granted'===Notification.permission)return!0;f((()=>'Attempting to request permissions'));const n=await Notification.requestPermission(),{datadogTags:u}=await(0,s.getInitializeOptions)();switch(f((()=>`Resulting permission: ${n}`)),n){case'granted':(0,t.airdogCount)('service_worker.push_notifications.permission_granted',1,u);break;case'denied':(0,t.airdogCount)('service_worker.push_notifications.permission_denied',1,u);break;case'default':(0,t.airdogCount)('service_worker.push_notifications.permission_default',1,u)}return'granted'===n},e.shouldShowPushNotificationsOptIn=async function(){if(await c())return!1;if('undefined'==typeof Notification)return f((()=>'Not showing push notifications since they\u2019re not supported')),!1;if('denied'===Notification.permission)return f((()=>'Not showing push notifications due to not having permission')),!1;return!0};var t=r(d[0]),n=r(d[1]),o=r(d[2]),s=r(d[3]),u=r(d[4]);const f=(0,n.createLogger)('Push:Permissions',(0,n.createPrefixStyle)('#b95f6f','#fff'));async function c(){return!!p()&&(0,u.hasValidDeviceId)()}function p(){return'undefined'!=typeof Notification&&'granted'===Notification.permission}}),"0a0e02",["3e4681","102445","f09318","436356","e62feb"]);
__d((function(g,r,i,a,m,e,d){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.makeDatadogTags=function(o){let s='unknown';(0,n.isAndroid)()?s='android':(0,n.isIos)()&&(s='ios');const t=`os:${s}`,u=`browser:${(0,n.getUserAgentName)()}`;return[t,u,o].join(',')};var n=r(d[0])}),"159ba6",["e9b7bf"]);
__d((function(g,r,i,a,m,e,d){"use strict";var t=r(d[0]).default;Object.defineProperty(e,"__esModule",{value:!0}),e.default=async function(t){const{tracking_context:c={}}=n.default.get('layout-init'),{appType:s}=await(0,p.getInitializeOptions)(),f=o.default.current().id,v=await(0,u.default)(f);if(!f)throw new Error('Cannot make a token without a valid userId.');return{appType:s,appVersion:`${c.controller}:${c.version}`,buildType:'RELEASE',deviceType:(0,l.default)(),deviceVersion:navigator.userAgent,nativeDeviceId:v,timeStamp:String((new Date).getTime()),token:JSON.stringify(t),tokenType:'VAPID',userId:f}};var n=t(r(d[1])),o=t(r(d[2])),u=t(r(d[3])),l=t(r(d[4])),p=r(d[5])}),"35b332",["ba7a76","ef2bc3","06a99e","e62feb","d93056","436356"]);
__d((function(g,r,i,a,m,e,d){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.hasValidPushSubscription=async function(){const{serviceWorkerRegistration:s}=await(0,n.getInitializeOptions)();if(!await(0,t.hasValidDeviceId)())return!1;return!!await s.pushManager.getSubscription()};var t=r(d[0]),n=r(d[1])}),"3d5c9c",["e62feb","436356"]);
__d((function(g,r,i,a,m,e,d){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=function(){return(0,t.getCookieSync)('_csrf_token').value||''};var t=r(d[0])}),"40eeb7",["13babd"]);
__d((function(g,r,i,a,m,e,d){"use strict";var t=r(d[0]).default;Object.defineProperty(e,"__esModule",{value:!0}),e.default=function({datadogTags:t,niobeClient:o}){'undefined'!=typeof Notification&&'denied'===Notification.permission&&(0,n.airdogCount)('service_worker.push_permission_denied',1,t);if(v=t,h=o,_(),!(0,l.hasPermission)())return;try{if(!s.default.isLoggedIn())return void(0,f.clearSubscription)();(0,f.updateSubscriptionIfOptedIn)()}catch(t){(0,c.reportError)(t)}},e.getInitializeOptions=async function(){if('undefined'==typeof navigator||!navigator||!navigator.serviceWorker)throw new Error('Push notifications requires a service worker to be available.');const t=await navigator.serviceWorker.ready;if(!t||!t.active)throw new Error('No service worker was activated, push notifications are not available.');await Promise.race([w,u.scheduler.wait({delay:3e4})]);const{tracking_context:s}=o.default.get('layout-init'),{controller:c}=s,l='homes-host-loop'===c?'GLOBAL_HOST':'GLOBAL_TRAVEL',f=t.active.scriptURL.split('/'),_=`/${f[f.length-1]}`,y=(0,p.makeDatadogTags)(`registered_path:${_}`),k=v?[v,y].join(','):y;h||(0,n.airdogCount)('service_worker.push_initialize_timeout',1,k);return{datadogTags:k,appType:l,niobeClient:h,pushNotificationsKey:o.default.get('pushNotificationsKey'),serviceWorkerRegistration:t}};var o=t(r(d[1])),n=r(d[2]),s=t(r(d[3])),c=r(d[4]),u=r(d[5]),l=r(d[6]),f=r(d[7]),p=r(d[8]);let v,h,_;const w=new Promise((t=>{_=t}))}),"436356",["ba7a76","ef2bc3","3e4681","06a99e","f2f40f","a2c93f","0a0e02","627c69","159ba6"]);
__d((function(g,r,i,a,m,e,d){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.Workbox=void 0,e.messageSW=n;try{self["workbox:window:6.1.1"]&&_()}catch(n){}function n(n,t){return new Promise((function(o){var s=new MessageChannel;s.port1.onmessage=function(n){o(n.data)},n.postMessage(t,[s.port2])}))}function t(n,t){for(var o=0;o<t.length;o++){var s=t[o];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(n,s.key,s)}}function o(n,t){(null==t||t>n.length)&&(t=n.length);for(var o=0,s=new Array(t);o<t;o++)s[o]=n[o];return s}function s(n,t){var s;if("undefined"==typeof Symbol||null==n[Symbol.iterator]){if(Array.isArray(n)||(s=(function(n,t){if(n){if("string"==typeof n)return o(n,t);var s=Object.prototype.toString.call(n).slice(8,-1);return"Object"===s&&n.constructor&&(s=n.constructor.name),"Map"===s||"Set"===s?Array.from(n):"Arguments"===s||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(s)?o(n,t):void 0}})(n))||t&&n&&"number"==typeof n.length){s&&(n=s);var c=0;return function(){return c>=n.length?{done:!0}:{done:!1,value:n[c++]}}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}return(s=n[Symbol.iterator]()).next.bind(s)}try{self["workbox:core:6.1.1"]&&_()}catch(n){}var c=function(){var n=this;this.promise=new Promise((function(t,o){n.resolve=t,n.reject=o}))};function u(n,t){var o=location.href;return new URL(n,o).href===new URL(t,o).href}var f=function(n,t){this.type=n,Object.assign(this,t)};function v(n,t,o){return o?t?t(n):n:(n&&n.then||(n=Promise.resolve(n)),t?n.then(t):n)}function h(){}var l={type:"SKIP_WAITING"};function p(n,t){if(!t)return n&&n.then?n.then(h):Promise.resolve()}e.Workbox=(function(o){var s,h;function y(n,t){var s,h;return void 0===t&&(t={}),(s=o.call(this)||this).nn={},s.tn=0,s.rn=new c,s.en=new c,s.on=new c,s.un=0,s.an=new Set,s.cn=function(){var n=s.fn,t=n.installing;s.tn>0||!u(t.scriptURL,s.sn)||performance.now()>s.un+6e4?(s.vn=t,n.removeEventListener("updatefound",s.cn)):(s.hn=t,s.an.add(t),s.rn.resolve(t)),++s.tn,t.addEventListener("statechange",s.ln)},s.ln=function(n){var t=s.fn,o=n.target,c=o.state,u=o===s.vn,v={sw:o,isExternal:u,originalEvent:n};!u&&s.mn&&(v.isUpdate=!0),s.dispatchEvent(new f(c,v)),"installed"===c?s.wn=self.setTimeout((function(){"installed"===c&&t.waiting===o&&s.dispatchEvent(new f("waiting",v))}),200):"activating"===c&&(clearTimeout(s.wn),u||s.en.resolve(o))},s.dn=function(n){var t=s.hn;t===navigator.serviceWorker.controller&&(s.dispatchEvent(new f("controlling",{sw:t,originalEvent:n,isUpdate:s.mn})),s.on.resolve(t))},s.gn=(h=function(n){var t=n.data,o=n.source;return v(s.getSW(),(function(){s.an.has(o)&&s.dispatchEvent(new f("message",{data:t,sw:o,originalEvent:n}))}))},function(){for(var n=[],t=0;t<arguments.length;t++)n[t]=arguments[t];try{return Promise.resolve(h.apply(this,n))}catch(n){return Promise.reject(n)}}),s.sn=n,s.nn=t,navigator.serviceWorker.addEventListener("message",s.gn),s}h=o,(s=y).prototype=Object.create(h.prototype),s.prototype.constructor=s,s.__proto__=h;var w,b,E=y.prototype;return E.register=function(n){var t=(void 0===n?{}:n).immediate,o=void 0!==t&&t;try{var s=this;return(function(n,t){var s=(function(){if(!o&&"complete"!==document.readyState)return p(new Promise((function(n){return window.addEventListener("load",n)})))})();return s&&s.then?s.then(t):t()})(0,(function(){return s.mn=Boolean(navigator.serviceWorker.controller),s.yn=s.pn(),v(s.bn(),(function(n){s.fn=n,s.yn&&(s.hn=s.yn,s.en.resolve(s.yn),s.on.resolve(s.yn),s.yn.addEventListener("statechange",s.ln,{once:!0}));var t=s.fn.waiting;return t&&u(t.scriptURL,s.sn)&&(s.hn=t,Promise.resolve().then((function(){s.dispatchEvent(new f("waiting",{sw:t,wasWaitingBeforeRegister:!0}))})).then((function(){}))),s.hn&&(s.rn.resolve(s.hn),s.an.add(s.hn)),s.fn.addEventListener("updatefound",s.cn),navigator.serviceWorker.addEventListener("controllerchange",s.dn,{once:!0}),s.fn}))}))}catch(n){return Promise.reject(n)}},E.update=function(){try{return this.fn?p(this.fn.update()):void 0}catch(n){return Promise.reject(n)}},E.getSW=function(){return void 0!==this.hn?Promise.resolve(this.hn):this.rn.promise},E.messageSW=function(t){try{return v(this.getSW(),(function(o){return n(o,t)}))}catch(n){return Promise.reject(n)}},E.messageSkipWaiting=function(){this.fn&&this.fn.waiting&&n(this.fn.waiting,l)},E.pn=function(){var n=navigator.serviceWorker.controller;return n&&u(n.scriptURL,this.sn)?n:void 0},E.bn=function(){try{var n=this;return(function(n,t){try{var o=n()}catch(n){return t(n)}return o&&o.then?o.then(void 0,t):o})((function(){return v(navigator.serviceWorker.register(n.sn,n.nn),(function(t){return n.un=performance.now(),t}))}),(function(n){throw n}))}catch(n){return Promise.reject(n)}},w=y,(b=[{key:"active",get:function(){return this.en.promise}},{key:"controlling",get:function(){return this.on.promise}}])&&t(w.prototype,b),y})((function(){function n(){this.Pn=new Map}var t=n.prototype;return t.addEventListener=function(n,t){this.Sn(n).add(t)},t.removeEventListener=function(n,t){this.Sn(n).delete(t)},t.dispatchEvent=function(n){n.target=this;for(var t,o=s(this.Sn(n.type));!(t=o()).done;)(0,t.value)(n)},t.Sn=function(n){return this.Pn.has(n)||this.Pn.set(n,new Set),this.Pn.get(n)},n})())}),"47df49",[]);
__d((function(g,r,i,a,m,e,d){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.AuthTriggerTypes=void 0;e.AuthTriggerTypes=(function(_){return _.CLAIM_GIFT_CARD="claim_gift_card",_.CONTACT_HOST="contact_host",_.BOOK_IT="book_it",_.BECOME_A_HOST="become_a_host",_.CLAIM_COUPON="claim_coupon",_.WISHLIST="wishlist",_.RESERVATION_ITINERARY="reservation_itinerary",_.REFERRAL="referral",_.PROHOST_LANDING="prohost_landing",_.REPORT_LISTING="report_listing",_.LUXURY_OWNER_ONBOARDING="luxury_owner_onboarding",_.LUXURY_RETREATS_CHECKOUT="luxury_retreats_checkout",_.HOST_REFERRAL="host_referral",_.REPORT_USER_PROFILE="report_user_profile",_.SIGNUP_LOGIN_PAGE="signup_login_page",_.PRO_SIGN_UP="pro_signup_page",_.PROPERTY_MANAGER_LISTING_INVITE="property_manager_listing_invite",_.RECAPTCHA="recaptcha",_.EVENT_SPACES_LANDING="event_spaces_landing",_.A4W_COVID_LANDING="a4w_covid_landing",_.HOST_REFERRAL_LANDING="host_referral_landing",_.CITY_PORTAL_LANDING="city_portal_landing",_.REPORT_REVIEW="report_review",_.BETA_PROGRAM_ENROLLMENT="beta_program_enrollment",_})({})}),"5eb3f8",[]);
__d((function(g,r,i,a,m,e,d){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var t={log:!0,markMilestone:!0};e.markMilestone=e.log=void 0;var o=r(d[0]),n=r(d[1]),c=r(d[2]);Object.keys(c).forEach((function(o){"default"!==o&&"__esModule"!==o&&(Object.prototype.hasOwnProperty.call(t,o)||o in e&&e[o]===c[o]||Object.defineProperty(e,o,{enumerable:!0,get:function(){return c[o]}}))}));var l=r(d[3]);Object.keys(l).forEach((function(o){"default"!==o&&"__esModule"!==o&&(Object.prototype.hasOwnProperty.call(t,o)||o in e&&e[o]===l[o]||Object.defineProperty(e,o,{enumerable:!0,get:function(){return l[o]}}))}));var u=r(d[4]);Object.keys(u).forEach((function(o){"default"!==o&&"__esModule"!==o&&(Object.prototype.hasOwnProperty.call(t,o)||o in e&&e[o]===u[o]||Object.defineProperty(e,o,{enumerable:!0,get:function(){return u[o]}}))}));var f=r(d[5]);Object.keys(f).forEach((function(o){"default"!==o&&"__esModule"!==o&&(Object.prototype.hasOwnProperty.call(t,o)||o in e&&e[o]===f[o]||Object.defineProperty(e,o,{enumerable:!0,get:function(){return f[o]}}))}));const s='Service Worker:Push Initializer';e.log=(0,o.createLogger)(s,(0,o.createPrefixStyle)('rebeccapurple','#fff')),e.markMilestone=(0,n.createMarkMilestone)(s,'web_push')}),"627c69",["102445","fae72a","9179c5","3d5c9c","e6eac9","907b9b"]);
__d((function(g,r,i,a,m,e,d){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.optIntoPushNotifications=async function(){const u=await(0,s.getInitializeOptions)();if(!await(0,n.requestPermission)())return(0,p.markMilestone)({options:u,metric:'permission_denied'}),!1;(0,p.markMilestone)({options:u,metric:'permission_granted'});if(await(0,t.hasValidDeviceId)())return(0,p.markMilestone)({description:"Using validated cached device id.",options:u,metric:'device_id_cached'}),await(0,o.verifyOrCreateSubscription)(),!0;(0,p.markMilestone)({description:"Creating a new device id and push subscription.",options:u,metric:'no_device_id_cached'});try{await(0,c.clearSubscription)()}finally{await(0,o.verifyOrCreateSubscription)()}return!0};var t=r(d[0]),n=r(d[1]),s=r(d[2]),o=r(d[3]),c=r(d[4]),p=r(d[5])}),"907b9b",["e62feb","0a0e02","436356","ea19bb","e6eac9","627c69"]);
__d((function(g,r,i,a,m,e,d){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.updateSubscriptionIfOptedIn=async function(){if(!await(0,t.hasValidDeviceId)())return(0,s.log)((()=>'user has not opted in, attempt to find and clear invalid push subscription')),(0,u.clearSubscription)();return(0,n.verifyOrCreateSubscription)()};var t=r(d[0]),n=r(d[1]),u=r(d[2]),s=r(d[3])}),"9179c5",["e62feb","ea19bb","e6eac9","627c69"]);
__d((function(g,r,i,a,m,e,d){"use strict";var t=r(d[0]).default;Object.defineProperty(e,"__esModule",{value:!0}),e.default=async function(t){const{niobeClient:n}=await(0,s.getInitializeOptions)(),{errors:l,data:c}=await n.mutate({mutation:u.default,variables:{request:t}});if(l&&l.length>0){const n='Failed to send push token due to network error';f((()=>[n,l]));const s={extra:{...l[0],...t},fingerprint:['PushTokenUpdateFailure']},u=new Error(l[0]?.message??n);throw(0,o.reportError)(u,s),u}return f((()=>['Sent push token to upstream server',c])),c?.pleiades?.writeToken?.deviceId};var n=r(d[1]),o=r(d[2]),s=r(d[3]),u=t(r(d[4]));const f=(0,n.createLogger)('Push:Send Token',(0,n.createPrefixStyle)('#b95f6f','#fff'))}),"96c3e8",["ba7a76","102445","f2f40f","436356","dbdcfd"]);
__d((function(g,r,i,a,m,e,d){"use strict";var n=r(d[0]).default;Object.defineProperty(e,"__esModule",{value:!0}),e.logSessionEnd=function(n){return t.default.logUniversalSessionEndEvent(n)},e.logSessionStart=function(n){return t.default.logUniversalSessionStartEvent(n)};var t=n(r(d[1]))}),"9e7031",["ba7a76","c8b97a"]);
__d((function(g,r,i,a,m,e,d){"use strict";var t=r(d[0]).default;Object.defineProperty(e,"__esModule",{value:!0}),e.default=async function(t){const{default:u}=await n.scheduler.postTask(s);return u(t)};var u=t(r(d[1])),n=r(d[2]);const s=()=>r(d[4])(d[3]).then(u.default)}),"a2fd9f",["ba7a76","45f788","a2c93f","436356","057569"]);
__d((function(g,r,i,a,m,e,d){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var _={StrengthIndicatorStatuses:!0,IsValidIndicatorStatuses:!0,TOSGroups:!0,Modals:!0,AuthMethods:!0,Boxes:!0,LoginMethods:!0,LoginMethodsForLogging:!0,SignupMethods:!0,SignupMethodsForLogging:!0,SignupPaneViews:!0,SignupPaneViewsForLogging:!0,SignupFormSteps:!0,MowebEmailViews:!0,FormNamesForIDs:!0,ModalTypes:!0,Panes:!0,Platforms:!0,AuthModalLifecycleStages:!0,AuthBoxLifecycleStages:!0,Providers:!0,NonPopupProviders:!0,ContextualLoginMethods:!0,SuggestedLoginMethods:!0,SuggestedLoginMethodLabels:!0,SuggestedLoginViews:!0,SocialAuthMethods:!0,SocialAuthSource:!0,LoginPaneViews:!0,CombineAuthPaneViews:!0,LocalStorageKeys:!0,BirthdateValidationStates:!0,PhoneSignupErrorStatuses:!0,SwitchModalSource:!0,AuthPagePaths:!0,DEFAULT_DELAY_SECONDS:!0};e.TOSGroups=e.SwitchModalSource=e.SuggestedLoginViews=e.SuggestedLoginMethods=e.SuggestedLoginMethodLabels=e.StrengthIndicatorStatuses=e.SocialAuthSource=e.SocialAuthMethods=e.SignupPaneViewsForLogging=e.SignupPaneViews=e.SignupMethodsForLogging=e.SignupMethods=e.SignupFormSteps=e.Providers=e.Platforms=e.PhoneSignupErrorStatuses=e.Panes=e.NonPopupProviders=e.MowebEmailViews=e.Modals=e.ModalTypes=e.LoginPaneViews=e.LoginMethodsForLogging=e.LoginMethods=e.LocalStorageKeys=e.IsValidIndicatorStatuses=e.FormNamesForIDs=e.DEFAULT_DELAY_SECONDS=e.ContextualLoginMethods=e.CombineAuthPaneViews=e.Boxes=e.BirthdateValidationStates=e.AuthPagePaths=e.AuthModalLifecycleStages=e.AuthMethods=e.AuthBoxLifecycleStages=void 0;var o=r(d[0]);Object.keys(o).forEach((function(O){"default"!==O&&"__esModule"!==O&&(Object.prototype.hasOwnProperty.call(_,O)||O in e&&e[O]===o[O]||Object.defineProperty(e,O,{enumerable:!0,get:function(){return o[O]}}))}));e.StrengthIndicatorStatuses=(function(_){return _.weak="weak",_.good="good",_.strong="strong",_})({}),e.IsValidIndicatorStatuses=(function(_){return _.invalid="invalid",_.valid="valid",_})({}),e.TOSGroups=(function(_){return _.WITH_CHECKBOX="with-checkbox",_.NO_CHECKBOX="no-checkbox",_.WITH_LAST_STEP="with-last-step",_})({}),e.Modals=(function(_){return _.LOGIN_MODAL="LOGIN_MODAL",_.SIGNUP_MODAL="SIGNUP_MODAL",_.FORGOT_PASSWORD_MODAL="FORGOT_PASSWORD_MODAL",_.SSO_MODAL="SSO_MODAL",_.LOGOUT_MODAL="LOGOUT_MODAL",_.NO_MODAL="NO_MODAL",_})({}),e.AuthMethods=(function(_){return _.PHONE="phone",_.OTP_PHONE="otp_phone",_.EMAIL="email",_.PHONE_OR_EMAIL="phone_or_email",_})({});e.Boxes={LOGIN_BOX:'LOGIN_BOX',SIGNUP_BOX:'SIGNUP_BOX',COMBINE_AUTH_BOX:'COMBINE_AUTH_BOX',COMBINE_OTP_PHONE_BOX:'COMBINE_OTP_PHONE_BOX',FORGOT_PASSWORD_BOX:'FORGOT_PASSWORD_BOX'};let O=e.LoginMethods=(function(_){return _.EMAIL_LOGIN="EMAIL_LOGIN",_.OTP_PHONE_LOGIN="OTP_PHONE_LOGIN",_.PHONE_LOGIN="PHONE_LOGIN",_.PHONE_OR_EMAIL_LOGIN="PHONE_OR_EMAIL_LOGIN",_})({});var n=(function(_){return _.EMAIL_LOGIN="email_login",_.OTP_PHONE_LOGIN="otp_phone_login",_.PHONE_LOGIN="phone_login",_.PHONE_OR_EMAIL_LOGIN="phone_or_email_login",_.OTP_PHONE_LOGIN_PHONE="otp_phone_login_phone",_})(n||{});O.EMAIL_LOGIN,n.EMAIL_LOGIN,O.OTP_PHONE_LOGIN,n.OTP_PHONE_LOGIN,O.PHONE_LOGIN,n.PHONE_LOGIN,O.PHONE_OR_EMAIL_LOGIN,n.PHONE_OR_EMAIL_LOGIN;e.LoginMethodsForLogging=(function(_){return _.EMAIL_LOGIN="email",_.OTP_PHONE_LOGIN="otp_phone",_.PHONE_LOGIN="phone",_.PHONE_OR_EMAIL_LOGIN="phone_or_email",_})({}),e.SignupMethods=(function(_){return _.PHONE_SIGNUP="PHONE_SIGNUP",_.EMAIL_SIGNUP="EMAIL_SIGNUP",_.MOWEB_EMAIL_SIGNUP="MOWEB_EMAIL_SIGNUP",_.SOCIAL_SIGNUP="SOCIAL_SIGNUP",_})({}),e.SignupMethodsForLogging=(function(_){return _.PHONE_SIGNUP="phone",_.EMAIL_SIGNUP="email",_})({});let t=e.SignupPaneViews=(function(_){return _.ALL_SIGNUP_OPTIONS="ALL_SIGNUP_OPTIONS",_.EMAIL_SIGNUP="EMAIL_SIGNUP",_.MOWEB_EMAIL_SIGNUP="MOWEB_EMAIL_SIGNUP",_.OTP_PHONE_MORE_OPTIONS="OTP_PHONE_MORE_OPTIONS",_.OTP_PHONE_VERIFY_CODE="OTP_PHONE_VERIFY_CODE",_.PHONE_SIGNUP="PHONE_SIGNUP",_.UNIFIED_SIGNUP="UNIFIED_SIGNUP",_})({});e.SignupPaneViewsForLogging={[t.PHONE_SIGNUP]:'phone',[t.EMAIL_SIGNUP]:'email',[t.MOWEB_EMAIL_SIGNUP]:'moweb_email',[t.ALL_SIGNUP_OPTIONS]:'all_options',[t.UNIFIED_SIGNUP]:'unified',[t.OTP_PHONE_MORE_OPTIONS]:'phone_otp_more_options',[t.OTP_PHONE_VERIFY_CODE]:'phone_otp_verify_code'};e.SignupFormSteps=(function(_){return _.ACCOUNT_INFO="ACCOUNT_INFO",_.PROFILE_INFO="PROFILE_INFO",_.UPDATE_PASSWORD="UPDATE_PASSWORD",_})({}),e.MowebEmailViews=(function(_){return _.EMAIL_AND_PASSWORD="EMAIL_AND_PASSWORD",_.NAMES_AND_BIRTHDATE="NAMES_AND_BIRTHDATE",_.TOS="TOS",_.TOS_DECLINED="TOS_DECLINED",_})({});const E=e.FormNamesForIDs={ACCOUNT_LOOKUP:'account-lookup',EMAIL_LOGIN:'email-login',FORGOT_PASSWORD:'forgot-password',OTP_PHONE_LOGIN:'otp-phone-login',PHONE_LOGIN:'phone-login',PHONE_OR_EMAIL_LOGIN:'phone-or-email-login'};O.EMAIL_LOGIN,O.OTP_PHONE_LOGIN,O.PHONE_LOGIN,O.PHONE_OR_EMAIL_LOGIN;e.ModalTypes=(function(_){return _.MODAL_TYPE_SIGNUP="signup",_.MODAL_TYPE_LOGIN="login",_})({}),e.Panes=(function(_){return _.LOGIN="login",_.SIGNUP="signup",_})({}),e.Platforms=(function(_){return _.WEB="web",_.MOWEB="moweb",_})({}),e.AuthModalLifecycleStages=(function(_){return _.INITIAL="INITIAL",_.MODAL_OPENED="MODAL_OPENED",_.FLOW_FINISHED="FLOW_FINISHED",_})({}),e.AuthBoxLifecycleStages=(function(_){return _.INITIAL="INITIAL",_.AUTH_FINISHED="AUTH_FINISHED",_.FLOW_FINISHED="FLOW_FINISHED",_})({});let I=e.Providers=(function(_){return _.FACEBOOK="Facebook",_.GOOGLE="Google",_.WECHAT="WeChat",_.ALIPAY="Alipay",_.WEIBO="Weibo",_.APPLE="Apple",_.NAVER="Naver",_})({});e.NonPopupProviders=[I.WECHAT,I.ALIPAY,I.WEIBO];e.ContextualLoginMethods=(function(_){return _.facebook="facebook",_.google="google",_.email="email",_.onelogin="onelogin",_.phone="phone",_.weibo="weibo",_.alipay="alipay",_.wechat="wechat",_})({});let N=e.SuggestedLoginMethods=(function(_){return _.email="email",_.facebook="facebook",_.google="google",_.apple="apple",_.naver="naver",_.otp_phone="otp_phone",_.onelogin="onelogin",_.undecided="undecided",_.wechat="wechat",_})({});e.SuggestedLoginMethodLabels={[N.email]:'Email',[N.facebook]:'Facebook',[N.google]:'Google',[N.apple]:'Apple',[N.naver]:'Naver',[N.otp_phone]:'Phone',[N.onelogin]:'OneLogin',[N.undecided]:'Undecided',[N.wechat]:'WeChat'};e.SuggestedLoginViews=(function(_){return _.single="single",_.multiple="multiple",_})({}),e.SocialAuthMethods=(function(_){return _.ALIPAY="alipay",_.FACEBOOK="facebook",_.FACEBOOK_PROMPT="facebook_prompt",_.GOOGLE="google",_.ONELOGIN="onelogin",_.WECHAT="wechat",_.WEIBO="weibo",_.APPLE="apple",_.HUAWEI="huawei",_.NAVER="naver",_})({}),e.SocialAuthSource=(function(_){return _.LOGIN_PROMPT="login_prompt",_.SUGGESTED_LOGIN="suggested_login",_.FACEBOOK_PROMPT="facebook_prompt",_.LOGIN="login",_.SIGNUP="signup",_})({}),e.LoginPaneViews=(function(_){return _.DEFAULT="default",_.SUGGESTED_LOGIN="suggested_login",_.EMAIL_UNIFIED="email_unified",_.EMAIL_UNIFIED_PASSWORD="email_unified_password",_.EMAIL_UNIFIED_SIGNUP="email_unified_signup",_.OTP_PHONE_VERIFY_CODE="otp_phone_verify_code",_.OTP_PHONE_MORE_OPTIONS="otp_phone_more_options",_.OTP_EMAIL_VERIFICATION="otp_email_verification",_.OTP_LOG_IN_ANOTHER_WAY="otp_log_in_another_way",_})({});let P=e.CombineAuthPaneViews=(function(_){return _.ALL_LOGIN_OPTIONS="ALL_LOGIN_OPTIONS",_.OTP_PHONE_LOGIN="OTP_PHONE_LOGIN",_.OTP_PHONE_VERIFY_CODE="OTP_PHONE_VERIFY_CODE",_.OTP_PHONE_MORE_OPTIONS="OTP_PHONE_MORE_OPTIONS",_.PHONE_OR_EMAIL_LOGIN="PHONE_OR_EMAIL_LOGIN",_.OTP_PHONE_SIGNUP="OTP_PHONE_SIGNUP",_.EMAIL_SIGNUP="EMAIL_SIGNUP",_})({});P.ALL_LOGIN_OPTIONS,O.OTP_PHONE_LOGIN,P.OTP_PHONE_LOGIN,O.OTP_PHONE_LOGIN,P.OTP_PHONE_VERIFY_CODE,O.OTP_PHONE_LOGIN,P.PHONE_OR_EMAIL_LOGIN,O.PHONE_OR_EMAIL_LOGIN,e.LocalStorageKeys={LOGOUT_ANYWAY_COUNT_V3:'logout_anyway_count_v3',LOGIN_PROMPT_DISMISSED:'login_prompt_dismissed',FACEBOOK_PROMPT_DISMISSED:'facebook_prompt_dismissed',FACEBOOK_PROMPT_DISMISSED_P3:'facebook_prompt_dismissed_p3',FACEBOOK_PROMPT_SHOW_COUNT:'facebook_prompt_show_count'};e.BirthdateValidationStates=(function(_){return _.INVALID="INVALID",_.UNDER_THIRTEEN="UNDER_THIRTEEN",_.UNDER_EIGHTEEN="UNDER_EIGHTEEN",_.OVER_EIGHTEEN="OVER_EIGHTEEN",_})({});e.PhoneSignupErrorStatuses={PHONE_ALREADY_USED_BY_PHONE_ACCOUNT:'phone_already_used_by_phone_account',PHONE_ALREADY_USED_BY_EMAIL_ACCOUNT:'phone_already_used_by_email_account',PHONE_ALREADY_USED_BY_SOCIAL_ACCOUNT:'phone_already_used_by_social_account',PHONE_ALREADY_USED_BY_EMAIL_OR_SOCIAL_ACCOUNT:'phone_already_used_by_email_or_social_account'};e.SwitchModalSource=(function(_){return _.ERROR_MESSAGE="error_message",_.SWITCH_CTA="switch_cta",_})({});e.AuthPagePaths={ACCOUNT_LINKING:'/account_linking',AUTHENTICATE:'/authenticate'},e.DEFAULT_DELAY_SECONDS=60}),"b616d2",["6126d0"]);
__d((function(g,r,i,a,m,e,d){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=function(){const{userAgent:t}=navigator;if((0,n.isAndroid)(t))return'ANDROID_VAPID';if((0,n.isIphone)(t))return'IPHONE_VAPID';if((0,n.isIpad)(t))return'IPAD_VAPID';return'DESKTOP_VAPID'};var n=r(d[0])}),"d93056",["e9b7bf"]);
__d((function(g,r,i,a,m,e,d){"use strict";var t=r(d[0]).default;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var n=t(r(d[1]));const u={document:void 0,getDocument:()=>r(d[3])(d[2]).then(n.default).then((t=>t.default)),name:'SendPushTokenMutation',type:'mutation',operationId:'35f85d8e0ca316c774486242fa697b3b3dd26597467c7744cd45fc6d25282d1c'};e.default=u}),"dbdcfd",["ba7a76","45f788","27c779","057569"]);
__d((function(g,r,i,a,m,e,d){"use strict";function t(){const n=r(d[0]);return t=function(){return n},n}Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;const n={RookeryMessagePackageEvent:t().RookeryMessagePackageEvent};e.default=n}),"e1839b",["ef628b"]);
__d((function(g,r,i,a,m,e,d){"use strict";var t=r(d[0]).default;function n(){const t=r(d[1]);return n=function(){return t},t}Object.defineProperty(e,"__esModule",{value:!0}),e.default=async function(t){const c=t||l();if(!c){const t='Cannot create device id with no user id';throw s((()=>t)),new Error(t)}const o=await _(),I=o?.deviceId;if(I&&p(c,o))return s((()=>`Using "${I}" as stored device push id`)),I;const w=(0,n().v4)();return(0,u.storeInCache)(v,f,h({deviceId:w,userId:c})),w},e.hasValidDeviceId=async function(){const t=l();if(!t)return!1;const n=await _();return p(t,n)};var c=t(r(d[2])),u=r(d[3]),o=r(d[4]);const s=(0,o.createLogger)('Push:Device Id',(0,o.createPrefixStyle)('#b95f6f','#fff')),f='push_token_id',v='airbnb_push_notifications',I=':';function h({deviceId:t,userId:n}){return`${n}${I}${t}`}function l(){return c.default.current().id}function _(){return(0,u.getFromCache)(v,f).then((t=>{if(!t)return;const[n,c]=t.split(I);return{userId:+n,deviceId:c}}))}function p(t,n){return!(!n?.deviceId||n?.userId!==t)}}),"e62feb",["ba7a76","305dd5","06a99e","fe8083","102445"]);
__d((function(g,r,i,a,m,e,d){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.clearSubscription=async function(){const o=await(0,n.getInitializeOptions)(),{serviceWorkerRegistration:u}=o,c=await u.pushManager.getSubscription();if(!c)return!0;try{await c.unsubscribe()}catch(n){(0,t.reportError)(n,{originalError:n}),(0,s.markMilestone)({options:o,metric:'unsubscribe_failure'})}return(0,s.log)((()=>'Push subscription has been unsubscribed.')),!0};var t=r(d[0]),n=r(d[1]),s=r(d[2])}),"e6eac9",["f2f40f","436356","627c69"]);
__d((function(g,r,i,a,m,e,d){"use strict";var t=r(d[0]).default;Object.defineProperty(e,"__esModule",{value:!0}),e.verifyOrCreateSubscription=async function(){if(!await(0,o.hasPermission)())return;const t=await(0,c.getInitializeOptions)(),{pushNotificationsKey:f,serviceWorkerRegistration:w}=t;try{let s=await w.pushManager.getSubscription();s||(s=await w.pushManager.subscribe({userVisibleOnly:!0,applicationServerKey:f}));const o=await(0,u.default)(s),c=await(0,n.default)(o);return(0,p.markMilestone)({description:`Push notifications successfully initialized with key: "${f}".`,options:t,metric:'push_subscribe_success',metricPrefix:'service_worker'}),c}catch(n){(0,p.markMilestone)({options:t,metric:'push_subscribe_unknown_failure',metricPrefix:'service_worker'}),(0,s.reportError)(n,{fingerprint:n?.message?['PushUnknownFailure']:void 0,originalError:n}),await(0,l.clearSubscription)()}};var s=r(d[1]),n=t(r(d[2])),o=r(d[3]),c=r(d[4]),u=t(r(d[5])),l=r(d[6]),p=r(d[7])}),"ea19bb",["ba7a76","f2f40f","96c3e8","0a0e02","436356","35b332","e6eac9","627c69"]);
__d((function(g,r,i,a,m,e,d){'use strict';Object.defineProperty(e,"__esModule",{value:!0});(e.RookeryMessagePackageEvent={defaultProps:{schema:'com.airbnb.jitney.event.logging.Rookery:RookeryMessagePackageEvent:1.0.0',event_name:'rookery_message_package'},propTypes:{}}).fullyQualifiedName='Rookery.v1.RookeryMessagePackageEvent'}),"ef628b",[]);
__d((function(g,r,i,a,m,e,d){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.createMarkMilestone=function(n,c="service_worker"){const s=(0,o.createLogger)(n,(0,o.createPrefixStyle)('rebeccapurple','#fff'));return function({count:o=1,options:n,metric:u,metricPrefix:f,description:l,tags:p}){const{datadogTags:_}=n,$=[_,p].filter(Boolean).join(','),j=f??c;(0,t.airdogCount)(`${j}.milestone`,o,[`metric:${u}`,$].join(',')),(0,t.airdogCount)(`${j}.${u}`,o,$),l&&s((()=>[l,{datadogTags:$,metric:u}]))}};var t=r(d[0]),o=r(d[1])}),"fae72a",["3e4681","102445"]);
__d((function(g,r,i,a,m,e,d){"use strict";var t=r(d[0]).default;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0,e.getServiceWorkerPath=L;var n=r(d[1]),o=t(r(d[2])),s=r(d[3]),c=t(r(d[4])),l=r(d[5]),p=r(d[6]),_=r(d[7]),f=r(d[8]),v=t(r(d[9])),h=t(r(d[10])),u=r(d[11]),w=r(d[12]),y=r(d[13]),k=r(d[14]),b=r(d[15]),E=t(r(d[16])),S=r(d[17]);const T=(0,l.createLogger)('ServiceWorker:Installer',(0,l.createPrefixStyle)('rebeccapurple','#fff')),A=(0,u.createMarkMilestone)('ServiceWorker:Installer');function C(t,n,o){const s=new URLSearchParams;Object.keys(n).forEach((t=>{const o=n[t];null!=o&&!1!==o&&s.append(t,String(o))})),o&&Object.keys(o).forEach((t=>{const n=o[t];null!=n&&s.append(t,String(n))}));const c=String(s);return c.length?`${t}?${c}`:t}function L(t,n={appType:'GLOBAL_TRAVEL',pushNotifications:!1,deliverAppShellExperiment:!1,deliverPreCachingExperiment:!1,deliverTripsOfflineExperiment:!1,dynamicPrecaching:!1,datadogTags:''}){const{deliverAppShellExperiment:o,deliverPWAExperiment:s,deliverPreCachingExperiment:l,deliverTripsOfflineExperiment:p,disableAppShell:_,dynamicPrecaching:f}=n,{force_disable_3p_js:h,force_env:u,force_staging:w,offline:y,sw_workbox_dev_logs:k,utm_source:E,enableReactProfiler:S}=(0,v.default)();return C(t,{dynamic_precaching:f,deliver_app_shell_experiment:o,deliver_pre_caching_experiment:l,deliver_trips_offline_experiment:p,disable_app_shell:_,force_disable_3p_js:h,force_env:u,force_staging:w,enableReactProfiler:S,offline:y,sw_workbox_dev_logs:k,sw_disable_niobe_cache:(0,b.getTreatmentOverride)('sw_disable_niobe_cache')??c.default.getBootstrap('sw_disable_niobe_cache'),sw_pwa_disable_niobe_cache:(0,b.getTreatmentOverride)('sw_pwa_disable_niobe_cache')??c.default.getBootstrap('sw_pwa_disable_niobe_cache'),sw_allow_shell_on_search_verticals:(0,b.getTreatmentOverride)('sw_allow_shell_on_search_verticals')??c.default.getBootstrap('sw_allow_shell_on_search_verticals'),utm_source:E},{sw_enable_offline:s})}function W(t,n){const{pushNotifications:o}=n;(0,p.addLoginCompleteCallback)((async()=>{await t.messageSW({type:'CLEAR_SHELL_CACHE'}),A({metric:'login_and_clear_cache',description:'Any caches storing an app shell have been cleared after login.',options:n}),o&&(0,w.updateSubscriptionIfOptedIn)()})),(0,p.addLogoutCallback)((async()=>{await t.messageSW({type:'CLEAR_SHELL_CACHE'}),A({metric:'logout_and_clear_cache',description:'Any caches storing an app shell have been cleared after logout.',options:n}),(0,w.clearSubscription)()}))}const O='skipping start of the service worker due to user opted out, remove your user from "temporarily_disable_service_workers_for_me" to opt back in.',R='service workers are globally disabled, skipping start';async function I(t,s={appType:'GLOBAL_TRAVEL',pushNotifications:!1,deliverTripsOfflineExperiment:!1,deliverAppShellExperiment:!1,deliverPreCachingExperiment:!1,dynamicPrecaching:!1,datadogTags:''}){const{appType:c,datadogTags:l,niobeClient:p,pushNotifications:v}=s,u=L(t,s),k=new n.Workbox(u,{updateViaCache:'all'}),b=`Initializing service worker at path: "${t}", see https://air.bb/service-workers for debugging guides.`;T((()=>[b,{pathWithParams:u}])),W(k,s),(0,_.addUpdateCurrencyCallback)((async()=>{await k.messageSW({type:'CLEAR_SHELL_CACHE'}),A({metric:'update_currency_and_clear_cache',description:'Any caches storing an app shell have been cleared after updating currency.',options:s}),v&&(0,w.updateSubscriptionIfOptedIn)()})),k.addEventListener('installed',(async t=>{A({options:s,metric:'installation',description:'Install event is fired'}),t.isUpdate?A({metric:'version_updated',description:'An installed service worker was updated to a new version.',options:s}):A({metric:'first_installation',description:'A new service worker has installed (for the first time)',options:s}),(s.dynamicPrecaching||s.deliverTripsOfflineExperiment)&&await k.messageSW({type:'PRECACHE_ASSETS',payload:{appVersion:"7096a79e19c067b77317193f3cc9bf9872e0fe5a"}})})),k.addEventListener('controlling',(async()=>{await k.messageSW({type:'FLUSH_MESSAGES'}),A({options:s,metric:'controlling',description:'The service worker is controlling the page, all behavior such as app shells, fetch handlers and push handlers are now ready.'})})),k.addEventListener('message',(t=>{switch(t.data.type){case'AIRDOG_BUMP':if('string'==typeof t.data.event)A({options:s,metric:`message.${t.data.event}`});else{const{name:n,count:o,tags:c}=t.data.event;A({count:o,options:s,metric:`message.${n}`,tags:c})}break;case'LOG_JITNEY_EVENT':o.default.logJitneyEvent({event_data:t.data.eventData,schema:E.default[t.data.schemaName]});break;case'SW_ERROR':A({description:'An error occurred in the service worker.',options:s,metric:'worker_error'}),(0,f.reportError)(t.data.error,{tags:{service_worker_error_type:'service_worker.worker_error'}});break;case'NOTIFICATION_CLICKED':A({description:'A push notification was clicked.',options:s,metric:'push_notification_clicked'}),(0,y.dispatchNotification)(t.data.payload)}})),k.addEventListener('activated',(async t=>{if(!t.isUpdate&&v){const t=await navigator.serviceWorker.getRegistration();t&&p&&(T((()=>'Initializing push notifications.')),await(0,h.default)({serviceWorkerRegistration:t,datadogTags:l,appType:c,niobeClient:p}))}A({description:'The service worker has finished activating.',options:s,metric:'activated_new_version'})})),k.addEventListener('waiting',(async()=>{if(await k.messageSW({type:'SKIP_WAITING'}))T((()=>'Manual reload signal in development received, reloading page')),location.reload(!0);else{const t='Automatic service worker activation failed, you may need to hard refresh the page to get the new worker.';T((()=>t))}A({options:s,metric:'waiting_to_install'})}));try{const t=await k.register();t&&v&&t.active&&p&&(T((()=>'Initializing push notifications.')),(0,h.default)({serviceWorkerRegistration:t,appType:c,datadogTags:l,niobeClient:p})),A({options:s,metric:'registration'})}catch(t){'SecurityError'!==t?.name?A({description:'The service worker failed to install.',options:s,metric:'failed_installation'}):T((()=>['The service worker failed to install due to a SecurityError',t]))}}async function P(t){try{if((await navigator.serviceWorker.getRegistrations()).length){T((()=>'No service worker was registered but one is active, removing and if in development, reloading the page.'));try{(0,S.unregisterServiceWorker)({legacyOnly:!1})}finally{}}}catch(n){'SecurityError'!==n?.name&&A({description:'The service worker failed to uninstall.',options:t,metric:'failed_uninstallation'})}}function x(t){return c.default.getBootstrap('disable_all_service_workers')||t}e.default=async(t,n={})=>{if('undefined'==typeof navigator||!navigator.serviceWorker)return;const o=`registered_path:${t}`,l=(0,k.makeDatadogTags)(o),p={...n,datadogTags:[l,n.datadogTags].filter(Boolean).join(',')};if(!t)return void await P(p);A({options:p,metric:'initialization_attempt'});const{forceResetServiceWorker:_}=(0,v.default)();if(_)return await(0,S.unregisterServiceWorker)({legacyOnly:!1}),void(window.location.search=window.location.search.replace('forceResetServiceWorker','swResetComplete'));const f=c.default.getBootstrap('temporarily_disable_service_workers_for_me'),h=x(f),u=await L(t,p);try{await(0,S.unregisterServiceWorker)({legacyOnly:!h,serviceWorkerPath:u,datadogTags:l})}catch(n){h?T((()=>f?O:R)):(await I(t,p),(0,s.airdogCount)('service_worker.initialization_failed',1,l))}h?T((()=>f?O:R)):await I(t,p)}}),"feb86f",["ba7a76","47df49","c8b97a","3e4681","c235f8","102445","9f7af8","737fda","f2f40f","a7c4ef","a2fd9f","fae72a","627c69","2d8379","159ba6","f9341a","e1839b","178ec4"]);
//# sourceMappingURL=https://sourcemaps.d.musta.ch/airbnb/static/packages/web/common/frontend/service-workers/initialize.69ad5176e3.js.map